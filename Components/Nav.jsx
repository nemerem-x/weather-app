import { useState, useRef } from 'react'
import '../src/App.css'
import Logo from '/weatherapplogo.png'
import Logo_light from '/weatherapplogolight.png'
import appTheme from '../src/recoil/themeAtom'
import { useRecoilValue } from 'recoil'
import { useRecoilState } from 'recoil'

function Nav({ handleOnChange, handleOnSubmit, coordinates, searchResult }) {

  const theme = useRecoilValue(appTheme)
  const [_, setTheme] = useRecoilState(appTheme);

  const onClick = (event) => {
    setTheme(oldTheme => !oldTheme);
  };

  const [selected, setselected] = useState("")
  const inputField = useRef(null)

  const select = (e) => {
    setselected(e.target.textContent)
    inputField.current.value = ""
  }

  const searchresults = searchResult.map(result => {
    return (
      <h4
        className={`p-6 cursor-pointer last:border-none border-b-[1px] first:rounded-t-xl last:rounded-b-xl   ${theme ? "border-gray-600 hover:bg-slate-800 text-gray-50" : "border-gray-300 hover:bg-slate-800 hover:text-gray-50"}`}
        onTouchEnd={(e) => handleOnSubmit(e, selected)}
        onMouseUp={(e) => handleOnSubmit(e, selected)}
        onTouchStart={select}
        onMouseDown={select}
        key={result.id}>{result.city}, {result.countryCode}
      </h4>
    )
  })

  return (
    <>
      <div className='flex m-auto max-w-[150px] md:hidden w-full justify-center mt-4 mb-8'><img src={theme ? Logo_light : Logo} alt="logo" /></div>
      <div className="relative w-full pt-2">
        <div className="flex items-center justify-center md:justify-between m-auto h-12 ">
          <img className='max-w-[150px] hidden md:block' src={theme ? Logo_light : Logo} alt="logo" />

          <div className='relative flex items-center h-10 w-80 md:right-[35px]'>
            <input
              className='absolute w-full rounded-3xl py-3 px-4 text-sm border-white border-2 focus:border-gray-900 focus:outline-none'
              ref={inputField}
              autoComplete='off'
              style={{ backgroundColor: coordinates === undefined ? "#ffdfdf" : '', border: coordinates === undefined ? "2px solid #ffa8a8" : "" }}
              name='searchQuery' onChange={(e) => handleOnChange(e)}
              type="text"
              placeholder='Search city'
            />
            <button className='absolute py-2 px-4 bg-gray-900 text-white rounded-3xl right-2 text-xs hover:bg-gray-600'
              onClick={handleOnSubmit}
              type="submit">
              Search
            </button>
          </div>

          <div className="flex justify-center items-center h-8 w-8 mx-6 cursor-pointer">
            {
              theme ?
                <svg onClick={onClick} width="25" height="25" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 32C19.2333 32 16.8753 31.0247 14.926 29.074C12.9753 27.1247 12 24.7667 12 22C12 19.2333 12.9753 16.8747 14.926 14.924C16.8753 12.9747 19.2333 12 22 12C24.7667 12 27.1253 12.9747 29.076 14.924C31.0253 16.8747 32 19.2333 32 22C32 24.7667 31.0253 27.1247 29.076 29.074C27.1253 31.0247 24.7667 32 22 32ZM2 24C1.43333 24 0.958667 23.808 0.576 23.424C0.192 23.0413 0 22.5667 0 22C0 21.4333 0.192 20.958 0.576 20.574C0.958667 20.1913 1.43333 20 2 20H6C6.56667 20 7.042 20.1913 7.426 20.574C7.80867 20.958 8 21.4333 8 22C8 22.5667 7.80867 23.0413 7.426 23.424C7.042 23.808 6.56667 24 6 24H2ZM38 24C37.4333 24 36.9587 23.808 36.576 23.424C36.192 23.0413 36 22.5667 36 22C36 21.4333 36.192 20.958 36.576 20.574C36.9587 20.1913 37.4333 20 38 20H42C42.5667 20 43.0413 20.1913 43.424 20.574C43.808 20.958 44 21.4333 44 22C44 22.5667 43.808 23.0413 43.424 23.424C43.0413 23.808 42.5667 24 42 24H38ZM22 8C21.4333 8 20.9587 7.808 20.576 7.424C20.192 7.04134 20 6.56667 20 6V2C20 1.43333 20.192 0.958 20.576 0.574C20.9587 0.191333 21.4333 0 22 0C22.5667 0 23.042 0.191333 23.426 0.574C23.8087 0.958 24 1.43333 24 2V6C24 6.56667 23.8087 7.04134 23.426 7.424C23.042 7.808 22.5667 8 22 8ZM22 44C21.4333 44 20.9587 43.808 20.576 43.424C20.192 43.0413 20 42.5667 20 42V38C20 37.4333 20.192 36.9587 20.576 36.576C20.9587 36.192 21.4333 36 22 36C22.5667 36 23.042 36.192 23.426 36.576C23.8087 36.9587 24 37.4333 24 38V42C24 42.5667 23.8087 43.0413 23.426 43.424C23.042 43.808 22.5667 44 22 44ZM9.3 12.1L7.15 10C6.75 9.63334 6.558 9.16667 6.574 8.6C6.59134 8.03334 6.78334 7.55 7.15 7.15C7.55 6.75 8.03334 6.55 8.6 6.55C9.16667 6.55 9.63334 6.75 10 7.15L12.1 9.3C12.4667 9.7 12.65 10.1667 12.65 10.7C12.65 11.2333 12.4667 11.7 12.1 12.1C11.7333 12.5 11.2753 12.6913 10.726 12.674C10.1753 12.658 9.7 12.4667 9.3 12.1V12.1ZM34 36.85L31.9 34.7C31.5333 34.3 31.35 33.8253 31.35 33.276C31.35 32.7253 31.5333 32.2667 31.9 31.9C32.2667 31.5 32.7253 31.3087 33.276 31.326C33.8253 31.342 34.3 31.5333 34.7 31.9L36.85 34C37.25 34.3667 37.442 34.8333 37.426 35.4C37.4087 35.9667 37.2167 36.45 36.85 36.85C36.45 37.25 35.9667 37.45 35.4 37.45C34.8333 37.45 34.3667 37.25 34 36.85ZM31.9 12.1C31.5 11.7333 31.3087 11.2747 31.326 10.724C31.342 10.1747 31.5333 9.7 31.9 9.3L34 7.15C34.3667 6.75 34.8333 6.558 35.4 6.574C35.9667 6.59134 36.45 6.78334 36.85 7.15C37.25 7.55 37.45 8.03334 37.45 8.6C37.45 9.16667 37.25 9.63334 36.85 10L34.7 12.1C34.3 12.4667 33.8333 12.65 33.3 12.65C32.7667 12.65 32.3 12.4667 31.9 12.1V12.1ZM7.15 36.85C6.75 36.45 6.55 35.9667 6.55 35.4C6.55 34.8333 6.75 34.3667 7.15 34L9.3 31.9C9.7 31.5333 10.1753 31.35 10.726 31.35C11.2753 31.35 11.7333 31.5333 12.1 31.9C12.5 32.2667 12.692 32.7253 12.676 33.276C12.6587 33.8253 12.4667 34.3 12.1 34.7L10 36.85C9.63334 37.25 9.16667 37.4413 8.6 37.424C8.03334 37.408 7.55 37.2167 7.15 36.85Z"
                    fill="#fff" />
                </svg>
                :
                <svg onClick={onClick} width="20" height="20" viewBox="0 0 30 30" fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <g clipPath="url(#clip0_409_2)">
                    <path d="M11.25 0.52126C11.433 0.743659 11.5452 1.01583 11.5719 1.30262C11.5986 1.5894 11.5388 1.87761 11.4 2.13001C10.316 4.12028 9.74988 6.35119 9.75375 8.61751C9.75375 16.1569 15.9 22.2619 23.475 22.2619C24.4631 22.2619 25.425 22.1588 26.3494 21.9619C26.6327 21.9005 26.9279 21.924 27.198 22.0294C27.4681 22.1347 27.7012 22.3173 27.8681 22.5544C28.0444 22.8009 28.1342 23.0986 28.1237 23.4015C28.1132 23.7043 28.0029 23.9951 27.81 24.2288C26.3394 26.0352 24.4842 27.4907 22.3797 28.4891C20.2752 29.4875 17.9743 30.0037 15.645 30C7.00125 30 0 23.0363 0 14.4563C0 7.99876 3.96375 2.46001 9.6075 0.11251C9.88863 -0.0063049 10.2007 -0.0306912 10.4969 0.0430147C10.7931 0.116721 11.0573 0.284539 11.25 0.52126Z" fill="#222222" />
                    <path d="M20.2388 5.9025C20.2656 5.8213 20.3174 5.75064 20.3868 5.70056C20.4561 5.65048 20.5395 5.62352 20.625 5.62352C20.7105 5.62352 20.7939 5.65048 20.8632 5.70056C20.9326 5.75064 20.9844 5.8213 21.0113 5.9025L21.7369 8.08125C22.0613 9.0525 22.8225 9.81375 23.7938 10.1381L25.9725 10.8638C26.0537 10.8906 26.1244 10.9424 26.1744 11.0118C26.2245 11.0811 26.2515 11.1645 26.2515 11.25C26.2515 11.3355 26.2245 11.4189 26.1744 11.4882C26.1244 11.5576 26.0537 11.6094 25.9725 11.6363L23.7938 12.3619C23.3147 12.5215 22.8795 12.7904 22.5225 13.1475C22.1654 13.5045 21.8965 13.9397 21.7369 14.4188L21.0113 16.5975C20.9844 16.6787 20.9326 16.7494 20.8632 16.7994C20.7939 16.8495 20.7105 16.8765 20.625 16.8765C20.5395 16.8765 20.4561 16.8495 20.3868 16.7994C20.3174 16.7494 20.2656 16.6787 20.2388 16.5975L19.5131 14.4188C19.3535 13.9397 19.0846 13.5045 18.7276 13.1475C18.3705 12.7904 17.9353 12.5215 17.4563 12.3619L15.2775 11.6363C15.1963 11.6094 15.1257 11.5576 15.0756 11.4882C15.0255 11.4189 14.9985 11.3355 14.9985 11.25C14.9985 11.1645 15.0255 11.0811 15.0756 11.0118C15.1257 10.9424 15.1963 10.8906 15.2775 10.8638L17.4563 10.1381C17.9353 9.97853 18.3705 9.70957 18.7276 9.35255C19.0846 8.99553 19.3535 8.56027 19.5131 8.08125L20.2388 5.9025ZM25.9931 0.185625C26.0116 0.132237 26.0463 0.0859424 26.0924 0.0531781C26.1384 0.0204137 26.1935 0.00280762 26.25 0.00280762C26.3065 0.00280762 26.3616 0.0204137 26.4077 0.0531781C26.4537 0.0859424 26.4884 0.132237 26.5069 0.185625L26.9906 1.63688C27.2063 2.28563 27.7144 2.79375 28.3631 3.00938L29.8144 3.49313C29.8678 3.51163 29.9141 3.54632 29.9468 3.59236C29.9796 3.63839 29.9972 3.69349 29.9972 3.75C29.9972 3.80651 29.9796 3.86161 29.9468 3.90764C29.9141 3.95368 29.8678 3.98837 29.8144 4.00688L28.3631 4.49063C28.0434 4.59698 27.7529 4.77641 27.5147 5.01466C27.2764 5.2529 27.097 5.54342 26.9906 5.86313L26.5069 7.31438C26.4884 7.36776 26.4537 7.41406 26.4077 7.44682C26.3616 7.47959 26.3065 7.49719 26.25 7.49719C26.1935 7.49719 26.1384 7.47959 26.0924 7.44682C26.0463 7.41406 26.0116 7.36776 25.9931 7.31438L25.5094 5.86313C25.403 5.54342 25.2236 5.2529 24.9854 5.01466C24.7471 4.77641 24.4566 4.59698 24.1369 4.49063L22.6856 4.00688C22.6322 3.98837 22.586 3.95368 22.5532 3.90764C22.5204 3.86161 22.5028 3.80651 22.5028 3.75C22.5028 3.69349 22.5204 3.63839 22.5532 3.59236C22.586 3.54632 22.6322 3.51163 22.6856 3.49313L24.1369 3.00938C24.7856 2.79375 25.2938 2.28563 25.5094 1.63688L25.9931 0.1875V0.185625Z" fill="#222222" />
                  </g>
                  <defs>
                    <clipPath id="clip0_409_2">
                      <rect width="30" height="30" fill="#222222" />
                    </clipPath>
                  </defs>
                </svg>
            }
          </div>
        </div>

        <div className={`${searchResult.length ? "block" : "hidden"} absolute h-auto w-80 ${theme ? "bg-slate-700" : "bg-gray-200"}  z-10 rounded-2xl left-[45%] md:left-[53%] translate-x-[-50%] border-2 ${theme ? "border-slate-700" : "border-gray-200"} drop-shadow-xl`}>
          <div>
            {searchresults}
          </div>
        </div>

      </div>
    </>
  )
}

export default Nav
